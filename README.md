# Телеграм-бот "Склад Тверь"

Бот для управления складом с функциями учета товаров и кассы.

[![GitHub](https://img.shields.io/badge/GitHub-Repository-blue)](https://github.com/RubeRoid-creat/skladtver_bot)

## Функции

1. **Добавление наименований товара** - создание новых товаров с указанием количества и цены (только для администраторов)
2. **Управление количеством товара** - изменение количества товара на складе (только для администраторов)
3. **Управление ценой товара** - изменение цены товара (только для администраторов)
4. **Продажа товара** - оформление продажи с автоматическим списанием и пополнением кассы (доступно всем)
5. **Управление кассой** - пополнение, снятие средств, просмотр истории операций
6. **Система админского доступа** - управление правами администраторов

### Система прав доступа

- **Администраторы** могут:
  - Добавлять товары
  - Изменять количество товаров
  - Изменять цены товаров
  - Продавать товары
  - Управлять администраторами (добавлять/удалять)

- **Обычные пользователи** могут:
  - Просматривать список товаров
  - Продавать товары

**Добавление первого администратора:** Отправьте команду `/admin` боту - первый пользователь автоматически станет администратором.

## Установка

1. Клонируйте репозиторий или скачайте файлы

2. Установите зависимости:
```bash
pip install -r requirements.txt
```

3. Создайте файл `.env` на основе `.env.example`:
```
BOT_TOKEN=your_telegram_bot_token_here
```

4. Получите токен бота у [@BotFather](https://t.me/BotFather) в Telegram

5. Запустите бота:
```bash
python bot.py
```

**Важно:** Если вы видите ошибку `Conflict: terminated by other getUpdates request`, это означает, что уже запущен другой экземпляр бота. 

**Решение:**
- Windows (PowerShell): Запустите `.\stop_bot.ps1` для остановки всех процессов Python, затем запустите бота снова
- Или вручную: `Get-Process python* | Stop-Process -Force`
- Linux/Mac: `pkill -f bot.py` или найдите процесс через `ps aux | grep bot.py` и остановите его

**Рекомендуется использовать скрипт для запуска:**
- Windows: `.\start_bot.ps1` (автоматически остановит предыдущие экземпляры)

## Использование

После запуска бота отправьте команду `/start` в Telegram для открытия главного меню.

### Команды

- `/start` - Главное меню
- `/help` - Справка
- `/products` - Список всех товаров
- `/cashbox` - Баланс кассы
- `/admin` - Добавить первого администратора (только если админов еще нет)

### Форматы ввода данных

- **Добавление товара**: `наименование товара , количество , цена`
  - Пример: `Молоко , 10 , 50.00`

- **Изменение количества**: `название | количество`
  - Пример: `Молоко | 15`

- **Изменение цены**: `название | цена`
  - Пример: `Молоко | 55.00`

- **Продажа товара**: `название | количество`
  - Пример: `Молоко | 5`

## База данных

Используется SQLite база данных `warehouse.db` с тремя таблицами:
- `products` - товары
- `cashbox` - операции кассы
- `admins` - администраторы (ID пользователей Telegram)

## Развертывание на сервере

Подробные инструкции по развертыванию на сервере см. в файле [DEPLOY.md](DEPLOY.md)

### Быстрый старт с Docker

```bash
# Создайте файл .env с токеном бота
echo "BOT_TOKEN=your_token" > .env

# Запустите контейнер
docker-compose up -d
```

### Развертывание с systemd

1. Настройте файл `skladtver-bot.service`
2. Скопируйте его в `/etc/systemd/system/`
3. Запустите: `sudo systemctl start skladtver-bot`

## Структура проекта

```
skladtver_bot/
├── bot.py                  # Основной файл бота
├── database.py             # Модуль работы с БД
├── requirements.txt        # Зависимости
├── .env.example           # Пример конфигурации
├── .gitignore             # Игнорируемые файлы
├── README.md              # Документация
├── DEPLOY.md              # Инструкции по развертыванию
├── deploy.sh              # Скрипт для деплоя
├── skladtver-bot.service  # Systemd сервис
├── Dockerfile             # Docker образ
└── docker-compose.yml     # Docker Compose конфигурация
```

## Лицензия

Этот проект создан для внутреннего использования.

